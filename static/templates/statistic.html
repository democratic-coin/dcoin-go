{{define "statistic"}}
<script>

	$('#profileclose').bind('click', function () {
		$("#profile_window").css("display", "none");
	});

	$('#find_user_info').bind('click', function () {
		dc_navigate ('statistic', {'user_info_id': $("#user_info_id").val()} );
	});

</script>

<script src="static/js/js.js"></script>
<div id="profile_window" style="display: none; width: 500px;	padding:10px 10px; background-color: #fff; border:  1px solid black; ">
	<button type="button" class="close" id="profileclose">Ã—</button>
	<div style="float: left; margin-right: 10px"><img id="profile_photo" width="200"></div>
	{{.Lang.abuses}}: <span id="profile_abuses"></span><br>
	{{.Lang.reg_time}}: <span id="profile_reg_time"></span>
	<div id="reloadbtn"></div>
</div>

<h1 class="page-header">{{.Lang.statistic}}</h1>

{{if .UserInfoId}}
	<h3>User ID: {{.UserInfoId}}</h3>
	<h3>{{.Lang.balances}}</h3>
	<table class="table table-bordered" style="width:600px">
	<thead><tr><th>{{.Lang.currency}}</th><th>{{.Lang.amount}}</th></tr></thead>
	{{if .UserInfoWallets}}
		{{range $k, $data := .UserInfoWallets}}
		<tr>
		{{if ge $data.CurrencyId 1000}}
			<td><a href="#cfPagePreview/onlyCfCurrencyName={{index $.CurrencyList $data.CurrencyId}}">{{index $.CurrencyList $data.CurrencyId}}</a></td>
		{{else}}
			<td>d{{index $.CurrencyList $data.CurrencyId}}</td>
		{{end}}
		<td>{{$data.Amount}}</td>
		</tr>
		{{end}}
	{{end}}
	</table>

	{{if .Credits}}
		<h3>{{.Lang.credits}}</h3>
		<table class="table table-bordered" style="width:600px">
		<thead><tr><th>{{.Lang.currency}}</th><th>{{.Lang.amount}}</th></tr></thead>
		<tbody>
		{{range $amount, $currency_id := .Credits}}
			<tr>
			<td>d{{index $.CurrencyList (strToInt64 $currency_id)}}</td>
			<td>{{index $amount}}</td>
			</tr>
		{{end}}
		</tbody>
		</table>
	{{end}}

	{{if .PromisedAmountListAccepted}}
	<h3>{{.Lang.promised_amounts}}</h3>
	<table class="table table-bordered" style="width:600px">
	<thead><tr><th>ID</th><th>{{.Lang.status}}</th><th style='text-align: center'>{{.Lang.currency}}</th><th style='text-align: center'>{{.Lang.amount}}</th><th style='text-align: center'>{{.Lang.pct_year}}</th><th>Coins</th></tr></thead>
	<tbody>
		{{range $k, $data := .PromisedAmountListAccepted}}

			<tr>
				<td>{{$data.Id}}</td>
				<td>{{$data.StatusText}}</td>
				<td style='text-align: center'>{{index $.CurrencyList $data.CurrencyId}}</td>
				<td style='text-align: center'>{{$data.Amount}}</td>
				<td style='text-align: center'>{{$data.Pct}}</td>
				<td>{{$data.Tdc}}</td>
			</tr>
		{{end}}
	</tbody>
	</table>
	{{end}}

{{end}}

<div class="form-horizontal" style="max-width: 800px">
	<fieldset>
		<div class="form-group">
			<label class="col-md-4 control-label" for="user_info_id">{{.Lang.user_info}}</label>
			<div class="col-md-4">
				<div class="input-group">
					<input id="user_info_id" name="user_info_id" class="form-control" type="text">
					<div class="input-group-btn">
						<button id="find_user_info" name="find_user_info" class="btn btn-primary">{{.Lang.find}}</button>
					</div>
				</div>
				<span class="help-block">{{.Lang.user_info_text}}</span>
			</div>
		</div>
	</fieldset>
</div>


<h3>{{.Lang.general}}</h3>
<table class="table table-bordered" style="width:600px">
<thead><tr><th>{{.Lang.currency}}</th><th>Coins</th><th>{{.Lang.promised_amounts}}</th><th>miners</th><th>users</th></tr></thead>
<tbody>
	{{if .SumWallets}}
		{{range $currencyId, $sumAmount := .SumWallets}}
		<tr>
			{{if and (gt $sumAmount 0.0) (lt $currencyId 1000)}}
				<td>d{{index $.CurrencyList $currencyId}}</td>
				<td>{{round $sumAmount 1}}</td>
				{{if or (ge $currencyId 1000) (eq $currencyId 1)}}
					<td>{{$.Lang.impossible}}</td>
				{{else}}
					<td>{{round (index $.SumPromisedAmount (int64ToStr $currencyId)) 2}}</td>
				{{end}}
				<td>{{index $.PromisedAmountMiners (int64ToStr $currencyId)}}</td><td>{{index $.WalletsUsers (int64ToStr $currencyId)}}</td>
			{{end}}
		</tr>
		{{end}}
	{{end}}
</tbody>
</table>

	<h3>{{.Lang.statistic_cash_requests}}</h3>
<table class="table table-bordered" style="width:600px">
	<thead><tr><th>ID</th><th>{{.Lang.time}}</th><th>from_user_id</th><th>to_user_id</th><th>{{.Lang.currency}}</th><th>{{.Lang.amount}}</th><th>{{.Lang.status}}</th></tr></thead>
	<tbody>
	{{if .CashRequests}}
		{{range $k, $data := .CashRequests}}
		<tr>
			<td>{{$data.id}}</td>
			<td>{{$data.time}}</td>
			<td style='text-align:center;vertical-align:middle'><div class='img_{{$data.from_user_id}}' style='width:60px;height:60px; border-radius:50%;margin:auto'></div>{{$data.from_user_id}}</td>
			<td style='text-align:center;vertical-align:middle'><div class='img_{{$data.to_user_id}}' style='width:60px;height:60px; border-radius:50%;margin:auto'></div>{{$data.to_user_id}}</td>
			<td>{{index $.CurrencyList (strToInt64 $data.currency_id)}}</td>
			<td>{{$data.amount}}</td>
			{{if ne $data.del_block_id "0"}}
				<td title='{{.Lang.reduction_closed}}'>{{$data.status}}</td>
			{{else}}
				<td>{{$data.status}}</td>
			{{end}}
		</tr>
		{{end}}
	{{end}}
	</tbody>
	</table>

<script>
	{{range $userId, $hosts := .RefPhotos}}
	var hosts = []
	{{range $k, $host := $hosts}}
	hosts.push({{$host}})
	{{end}}
	get_img_refs (0, {{$userId}}, hosts)
	{{end}}
</script>

<h3>{{.Lang.pct}}</h3>

{{if $.CurrencyPct}}
	<table class="table table-bordered" style="width:500px">
	<thead><tr><th>{{.Lang.currency}}</th><th>{{.Lang.pct_block}} miner</th><th>{{.Lang.pct_block}} user</th></tr></thead>
	<tbody>
	{{range $currencyId, $data := .CurrencyPct}}
		{{if or (ne $data.miner "0.0000000000000") (ne $data.user "0.0000000000000")}}
		<tr>
			<td>d{{$data.name}}</td>
			<td>{{$data.miner}}</td>
			<td>{{$data.user}}</td>
		</tr>
		{{end}}
	{{end}}
	</tbody>
	</table>
{{end}}

<h3>count_users</h3>
<table class="table table-bordered" style="width:600px">
	<tbody>
	<tr><td>{{$.CountUsers}}</td></tr>
	</tbody>
</table>


<h3>{{.Lang.reduction_title}} <span style="font-size:15px">(<a href="{{.Lang.reduction_wiki_link}}" target="_blank">wki</a>)</span></h3>
{{if .Reduction}}
	<table class="table table-bordered" style="width:500px">
	<thead><tr><th>{{.Lang.time}}</th><th>{{.Lang.currency}}</th><th>{{.Lang.reduction_pct}}</th><th>Block_id</th><th>type</th></tr></thead>
	<tbody>
	{{range $k, $data := .Reduction}}
		{{if $data.pct}}
		<tr>
			<td>{{$data.time}}</td>
			<td>d{{index $.CurrencyList (strToInt64 $data.currency_id)}}</td>
			<td>{{$data.pct}}</td>
			<td>{{$data.block_id}}</td>
			<td>{{$data.type}}</td>
		</tr>
		{{end}}
	{{end}}
	</tbody>
	</table>
{{end}}

{{end}}